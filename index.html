<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JARVIS AI Bot</title>
  <style>
    body {
      margin: 0;
      background: radial-gradient(ellipse at center, #0a0f1f 0%, #000 100%);
      color: #00ffe7;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
    }
    h1 {
      margin-top: 30px;
      font-size: 3em;
      color: #00ffcc;
      text-shadow: 0 0 20px #00ffcc;
    }
    #output {
      margin: 30px auto;
      width: 80%;
      background: #111;
      border-radius: 10px;
      padding: 20px;
      font-size: 1.2em;
      min-height: 100px;
      box-shadow: 0 0 20px #00ffcc66;
    }
    .status {
      margin-top: 10px;
      font-size: 0.9em;
      color: #888;
    }
  </style>
</head>
<body>
  <h1>JARVIS AI</h1>
  <div id="output">Say "Jarvis, what’s the weather?" or ask anything…</div>
  <div class="status">Listening...</div>

  <script>
    const apiKey = "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";  // Replace with your OpenAI API key
    const output = document.getElementById('output');
    const synth = window.speechSynthesis;
    const reminders = JSON.parse(localStorage.getItem("jarvis_reminders") || "[]");

    const maleVoicePref = () => {
      const voices = speechSynthesis.getVoices();
      return voices.find(v => v.name.includes("Male") || v.name.includes("Daniel") || v.name.includes("Google UK English Male")) || voices[0];
    };

    const speak = (text) => {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.voice = maleVoicePref();
      synth.speak(utterance);
    };

    const processCommand = async (text) => {
      const lower = text.toLowerCase();

      if (lower.includes("weather")) {
        fetch("https://ipapi.co/json")
          .then(res => res.json())
          .then(loc => {
            const location = loc.city || "your location";
            fetch(`https://api.open-meteo.com/v1/forecast?latitude=${loc.latitude}&longitude=${loc.longitude}&current_weather=true`)
              .then(r => r.json())
              .then(data => {
                const temp = data.current_weather.temperature;
                const response = `The current temperature in ${location} is ${temp}°C.`;
                output.innerText = response;
                speak(response);
              });
          });
      } else if (lower.startsWith("play music")) {
        speak("Playing your favorite song.");
        const audio = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3");
        audio.play();
      } else if (lower.startsWith("remind me to")) {
        const reminder = text.replace(/remind me to/i, "").trim();
        reminders.push({ text: reminder, date: new Date().toDateString() });
        localStorage.setItem("jarvis_reminders", JSON.stringify(reminders));
        const res = `Reminder saved: ${reminder}`;
        output.innerText = res;
        speak(res);
      } else {
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + apiKey
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [{ role: "user", content: text }],
            temperature: 0.7
          })
        });

        const data = await res.json();
        const reply = data.choices[0]?.message?.content || "Sorry, I didn't understand that.";
        output.innerText = reply;
        speak(reply);
      }
    };

    // Check for reminders on load
    window.onload = () => {
      const today = new Date().toDateString();
      reminders.forEach(r => {
        if (r.date !== today) {
          speak(`You asked me to remind you: ${r.text}`);
        }
      });
    };

    // Continuous Speech Recognition
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = true;
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.onresult = (event) => {
      const last = event.results.length - 1;
      const text = event.results[last][0].transcript.trim();
      if (text.toLowerCase().startsWith("jarvis")) {
        const command = text.replace(/^jarvis[, ]*/i, "");
        processCommand(command);
      }
    };
    recognition.onerror = (e) => console.error(e.error);
    recognition.start();
  </script>
</body>
</html>
