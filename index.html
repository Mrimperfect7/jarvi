<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JARVIS AI Assistant</title>
  <style>
    body {
      margin: 0;
      font-family: 'Orbitron', sans-serif;
      background: radial-gradient(#0a0a0a, #1a1a1a);
      color: #0ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    h1 {
      margin-top: 30px;
      font-size: 3rem;
      text-shadow: 0 0 10px #0ff;
    }
    #output {
      margin-top: 20px;
      background: #111;
      padding: 20px;
      width: 80%;
      max-width: 700px;
      border-radius: 10px;
      box-shadow: 0 0 20px #0ff2;
      overflow-y: auto;
      height: 300px;
    }
    #output p {
      margin: 10px 0;
    }
    #status {
      margin-top: 10px;
      font-size: 0.9rem;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h1>JARVIS AI</h1>
  <div id="output"></div>
  <div id="status">Listening...</div>

  <script>
    const OPENAI_API_KEY = "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";

    const output = document.getElementById("output");
    const status = document.getElementById("status");

    const synth = window.speechSynthesis;
    let voice = null;

    // Get male voice
    function setMaleVoice() {
      const voices = synth.getVoices();
      voice = voices.find(v => /en-US|en-GB/.test(v.lang) && v.name.toLowerCase().includes("male")) ||
              voices.find(v => /en-US/.test(v.lang));
    }

    // Load voices
    window.speechSynthesis.onvoiceschanged = setMaleVoice;

    function speak(text) {
      if (!voice) setMaleVoice();
      const utter = new SpeechSynthesisUtterance(text);
      utter.voice = voice;
      utter.rate = 1;
      synth.speak(utter);
    }

    async function getAIResponse(message) {
      const messages = [
        { role: "system", content: "You are JARVIS, a smart futuristic AI assistant like Iron Man's AI." },
        { role: "user", content: message }
      ];

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: messages,
          temperature: 0.7
        })
      });

      const data = await response.json();
      const reply = data.choices?.[0]?.message?.content?.trim() || "Sorry, I couldn't process that.";
      return reply;
    }

    const reminders = [];

    function handleCommand(text) {
      const lower = text.toLowerCase();

      if (lower.includes("weather")) {
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(pos => {
            const { latitude, longitude } = pos.coords;
            fetch(`https://api.weatherapi.com/v1/current.json?key=80fdf66c8c5344fba6d172946251107&q=${latitude},${longitude}`)
              .then(res => res.json())
              .then(data => {
                const report = `Current temperature in ${data.location.name} is ${data.current.temp_c}Â°C with ${data.current.condition.text}`;
                logOutput("JARVIS: " + report);
                speak(report);
              });
          });
        } else {
          logOutput("JARVIS: Location not supported.");
          speak("Sorry, I can't access your location.");
        }
        return;
      }

      if (lower.includes("remind me to")) {
        const task = text.split("remind me to")[1]?.trim();
        if (task) {
          const today = new Date();
          reminders.push({ task, date: today.getDate() + 1 });
          const response = `Okay, I will remind you tomorrow to ${task}.`;
          logOutput("JARVIS: " + response);
          speak(response);
        }
        return;
      }

      if (lower.includes("play music")) {
        const audio = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3");
        audio.play();
        speak("Playing music.");
        return;
      }

      getAIResponse(text).then(reply => {
        logOutput("JARVIS: " + reply);
        speak(reply);
      });
    }

    function logOutput(text) {
      const p = document.createElement("p");
      p.textContent = text;
      output.appendChild(p);
      output.scrollTop = output.scrollHeight;
    }

    // Reminder check
    function checkReminders() {
      const today = new Date().getDate();
      reminders.forEach(r => {
        if (r.date === today) {
          const msg = `Reminder: ${r.task}`;
          logOutput("JARVIS: " + msg);
          speak(msg);
        }
      });
    }

    // Start continuous recognition
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang = "en-US";

    recognition.onresult = (event) => {
      const transcript = event.results[event.results.length - 1][0].transcript.trim();
      logOutput("You: " + transcript);
      handleCommand(transcript);
    };

    recognition.onerror = (e) => {
      status.textContent = "Error: " + e.error;
      recognition.stop();
      setTimeout(() => recognition.start(), 2000);
    };

    recognition.onend = () => {
      recognition.start();
    };

    recognition.start();
    checkReminders();
  </script>
</body>
</html>
